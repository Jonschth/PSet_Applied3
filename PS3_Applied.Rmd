---
title: "PS3_Applied"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

output: 
  pdf_document:
    number_sections: yes
  html_document:
    df_print: paged
urlcolor: blue
---
```{r, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
knitr::opts_chunk$set(tidy = "styler")
knitr::opts_chunk$set(fig.height = 3, fig.width = 5)
```


```{r message=FALSE, warning=FALSE, include = FALSE}
library(tidyverse)
library(testthat)
library(pryr)
library(lubridate)
library(ggplot2)
library(tidycensus)
```

This submission is our work alone and complies with the 30535 integrity policy.

Add your initials to indicate your agreement: **RM** **VS**

Ryan late coins used this pset: 0. Late coins left: 0. 
Vera late coins used this pset: 0. Late coins left: 1. 

#Load and glimpse

## Load and glimpse
```{r}
gun_violence <- read_csv("gun-violence-data_01-2013_03-2018.csv")

glimpse(gun_violence)
```
1.1 There are 239,677 rows and 29 columns.
1.2 The variables are: 
incident_id
date,state
city_or_county
address,n_killed

n_injured
incident_url
source_url
incident_url_fields_missing
congressional_district
gun_stolen
gun_type
incident_characteristics - *this is very interesting as it gives a good overview over the incident.  It may be helpful to seperate this variable into more variables*
latitude,location_description
longitude,n_guns_involved,notes
participant_age
participant_age_group
participant_gender
participant_name
participant_relationship
participant_status
participant_type
sources
state_house_district
state_senate_district	

1.3. 
We may want to format the following variables as factors: gun_stolen, gun_type,incident_characteristics, participant_age and Pariticpant_age_group, participant_status and participant_type




## Explore
```{r}
head(gun_violence)
```



## Format

We might have to format the participant variables, gun stolen, gun type, incident chracteristics into factors


# Time

## Date
```{r}
gun_violence$date %>% 
  str()
```
It is aldready  in the date format.

## Increasing by year?

```{r}
gun_violence %>% 
mutate(year = year(date)) %>% 
  group_by(year) %>% 
  summarize(count = n()) %>% 
ggplot(aes(year, count)) +
  geom_bar(stat = "identity")
```

## month



```{r}
gun_violence %>% 
mutate(month = month(date, label = TRUE)) %>% 
mutate(year=year(date)) %>% 
  group_by(month,year) %>% 
  summarize(count = n()) %>% 
  ggplot(aes(month, count)) +
    geom_bar(stat = "identity")+
    facet_wrap(~year)+
      theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
      theme(panel.spacing = unit(1, "lines"))
```
Generally speaking I think the summer months have more shoting incidents.  It is hard to distinguish between June, July and August


## Day

```{r}
gun_violence %>% 
  mutate(wday = wday(date, label = TRUE)) %>% 
  mutate(year=year(date)) %>%
  group_by(wday, year) %>% 
  summarize(count = n()) %>% 
  ggplot(aes(wday, count)) +
    geom_bar(stat = "identity")+
    facet_wrap(~year)+
      theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
      theme(panel.spacing = unit(1, "lines"))
```

## Summary

More violence om weekends, more violence in the summer, and more violence over the years.


# Characteristics

## Avg number guns
```{r}
gun_violence %>% 
  filter(n_guns_involved != is.na(n_guns_involved)) 
  summarize(mean = mean(n_guns_involved))
```
100,000 rows are missing this data, and of the ones that recorded, there 1.37 guns per incident.

## Type of guns

```{r}
gun_violence %>% 
  filter(!is.na(gun_type)) %>% 
  group_by(gun_type) %>%
  drop_na(gun_type) %>% 
  summarise(n=n()) %>% 
  flatten(gun_type)


unlist(gun_violence$gun_type[1])

gun_violence$gun_type %>% 
  head(10)
flatten_chr(gun_violence$gun_type[3])
```


##incident characteristics

```{r}
gun_violence$incident_characteristics %>% 
  head()
```
Incident characteristics are telling us what happened during the shooting and what kind of crime it was (mass shooting/)

## most common
```{r}
fct_lump((n = 20))
```



# suspects characterisitics

```{r}

gun_violence$participant_age %>% 
  head()
gun_violence$participant_gender %>% 
  head()
gun_violence$participant_type %>% 
  head()
gun_violence$participant_status %>% 
  head()
```
## Avg number suspects and victims
```{r}

```



#geographic variation

# mass shootings
