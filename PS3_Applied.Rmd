---
title: "PS3_Applied"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

output: 
  pdf_document:
    number_sections: yes
  html_document:
    df_print: paged
urlcolor: blue
---
```{r, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
knitr::opts_chunk$set(tidy = "styler")
knitr::opts_chunk$set(fig.height = 3, fig.width = 5)
```


```{r message=FALSE, warning=FALSE, include = FALSE}
library(stringi)
library(splitstackshape)
library(tidyverse)
library(testthat)
library(pryr)
library(lubridate)
library(ggplot2)
library(tidycensus)
```

This submission is our work alone and complies with the 30535 integrity policy.

Add your initials to indicate your agreement: **RM** **VS**

Ryan late coins used this pset: 0. Late coins left: 0. 
Vera late coins used this pset: 0. Late coins left: 1. 

#Load and glimpse

## Load and glimpse
```{r}
gun_violence <- read_csv("gun-violence-data_01-2013_03-2018.csv")

glimpse(gun_violence)
```
1.1 There are 239,677 rows and 29 columns.
1.2 The variables are: 
incident_id
date,state
city_or_county
address,n_killed

n_injured
incident_url
source_url
incident_url_fields_missing
congressional_district
gun_stolen
gun_type
incident_characteristics - *this is very interesting as it gives a good overview over the incident.  It may be helpful to seperate this variable into more variables*
latitude,location_description
longitude,n_guns_involved,notes
participant_age
participant_age_group
participant_gender
participant_name
participant_relationship
participant_status
participant_type
sources
state_house_district
state_senate_district	

1.3. 
We may want to format the following variables as factors: gun_stolen, gun_type,incident_characteristics, participant_age and Pariticpant_age_group, participant_status and participant_type




## Explore
```{r}
head(gun_violence)
```



## Format

We might have to format the participant variables, gun stolen, gun type, incident chracteristics into factors


# Time

## Date
```{r}
gun_violence$date %>% 
  str()
```
It is aldready  in the date format.

## Increasing by year?

```{r}
gun_violence %>% 
mutate(year = year(date)) %>% 
  group_by(year) %>% 
  summarize(count = n()) %>% 
ggplot(aes(year, count)) +
  geom_bar(stat = "identity")
```

## month



```{r}
gun_violence %>% 
mutate(month = month(date, label = TRUE)) %>% 
mutate(year=year(date)) %>% 
  group_by(month,year) %>% 
  summarize(count = n()) %>% 
  ggplot(aes(month, count)) +
    geom_bar(stat = "identity")+
    facet_wrap(~year)+
      theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
      theme(panel.spacing = unit(1, "lines"))

```
Generally speaking I think the summer months have more shoting incidents.  It is hard to distinguish between June, July and August


## Day

```{r}
gun_violence %>% 
  mutate(wday = wday(date, label = TRUE)) %>% 
  mutate(year=year(date)) %>%
  group_by(wday, year) %>% 
  summarize(count = n()) %>% 
  ggplot(aes(wday, count)) +
    geom_bar(stat = "identity")+
    facet_wrap(~year)+
      theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
      theme(panel.spacing = unit(1, "lines"))+
  labs(x='Weekday', y='Number of incidents', title='Incidents by Weekday')
```

## Summary

More violence om weekends, more violence in the summer, and more violence over the years.


# Characteristics

## Avg number guns
```{r}
gun_violence %>% 
  filter(n_guns_involved != is.na(n_guns_involved)) 
  summarize(mean = mean(n_guns_involved))
```
100,000 rows are missing this data, and of the ones that recorded, there 1.37 guns per incident.

## Type of guns
Incredibly complicated but got there in the end- the graph needs to be be labelled etc

```{r}


    
  
gun_violence$gun_type <- gsub("\\|\\|", "|", gun_violence$gun_type)

gun_type_columnized <- splitstackshape::cSplit(gun_violence %>% select( gun_type), 'gun_type', sep =  '|', direction="long")

gun_type_columnized



gun_types_cleaned<- gun_type_columnized %>% 
  drop_na() %>% 
  filter(str_detect(gun_type,"Unknown", negate = TRUE)) %>%  
  mutate(gun=stri_sub(gun_type,4))

gun_types_cleaned

gun_types_cleaned %>%
  group_by(gun) %>% 
  summarise(count=n()) %>% 
  ggplot(aes(x=gun, count))+
  geom_histogram(stat="identity")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))



    
```


##incident characteristics

```{r}
gun_violence$incident_characteristics %>% 
  head()
```
Incident characteristics are telling us what happened during the shooting and what kind of crime it was (mass shooting/)

## most common
```{r}
fct_lump((n = 20))
```



# suspects characterisitics

got help from https://www.kaggle.com/erikbruin/gun-violence-in-the-us-eda-and-rshiny-app


```{r}


gun_violence$incident_characteristics <- gsub("\\|\\|", "|", gun_violence$incident_characteristics)

IncCharac <- splitstackshape::cSplit(gun_violence %>% select(incident_id, state, city_or_county, incident_characteristics), 'incident_characteristics', sep =  '|', direction="long")



numCat <- round(nrow(IncCharac)/nrow(gun_violence),1)
cat('On average, there are', numCat, 'incident categories specified per incident')

IncCharac %>% 
  head(10)

```
## Avg number suspects and victims
```{r}

```



#geographic variation

# mass shootings
